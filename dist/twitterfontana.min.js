var _base,__indexOf=[].indexOf||function(t){for(var e=0,s=this.length;s>e;e++)if(e in this&&this[e]===t)return e;return-1},__hasProp={}.hasOwnProperty,__extends=function(t,e){function s(){this.constructor=t}for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t};null==this.Fontana&&(this.Fontana={}),null==(_base=this.Fontana).datasources&&(_base.datasources={}),this.Fontana.datasources.Static=function(){function t(t){this.messages=null!=t?t:[]}return t.prototype.setMessages=function(t){return null==this.messages&&(this.messages=[]),this.mesages=t.concat(this.mesages)},t.prototype.getMessages=function(t){return t?setTimeout(function(e){return function(){return t(e.messages)}}(this),0):void 0},t}(),this.Fontana.datasources.HTML=function(){function t(t){this.container=t,this.messages=[]}return t.prototype.extractMessages=function(){var t;return t=[],$(".message",this.container).each(function(e,s){return t.push({id:s.id,created_at:(new Date).toString(),text:$(".text",s).text(),user:{name:$(".name",s).text(),screen_name:$(".screen_name",s).text().replace(/^@/,""),profile_image_url:$(".avatar",s).attr("src")}})}),t},t.prototype.getMessages=function(t){var e,s,n;return e=[function(){var t,e,n,a;for(n=this.messages,a=[],t=0,e=n.length;e>t;t++)s=n[t],a.push(s.id);return a}.call(this)],n=[],this.extractMessages().forEach(function(t){var s;return s=t.id,__indexOf.call(e,s)<0?n.push(t):void 0}),this.messages=n.concat(this.messages),t?setTimeout(function(e){return function(){return t(e.messages)}}(this),0):void 0},t}(),this.Fontana.datasources.TwitterSearch=function(){function t(t){this.q=t,this.params={since_id:1,q:this.q,result_type:"recent"},this.lastCall=0,this.messages=[],this.getJSON=$.getJSON("/api/twitter/search/",this.params)}var e;return e=5e3,t.prototype.getMessages=function(t){var s;return s=(new Date).getTime(),s-this.lastCall<e?t?setTimeout(function(e){return function(){return t(e.messages)}}(this),0):void 0:(this.lastCall=(new Date).getTime(),this.getJSON.success(function(e){return function(s){return s.statuses.length&&(e.messages=s.statuses.concat(e.messages),e.params.since_id=e.messages[0].id_str),t?t(e.messages.length?e.messages:[{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Your search term returned no Tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}}(this)).error(function(){return t?t([{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Error fetching tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}))},t}(),this.Fontana.datasources.TwitterSearchFA=function(t){function e(t,s,n){this.q=t,this.http=s,this.url=n,e.__super__.constructor.call(this,this.q),null==this.url&&(this.url="https://api.twitter.com/1.1/search/tweets.json"),this.getJSON=this.http.get({url:this.url,data:this.params,dataType:"json"})}return __extends(e,t),e}(this.Fontana.datasources.TwitterSearch);var nano;nano=function(t,e){return t.replace(/\{([\w\.]*)\}/g,function(t,s){var n,a,i,r;for(n=s.split("."),a=e[n.shift()],i=0,r=n.length;r>i;i++)s=n[i],a=a[s];return"undefined"!=typeof a&&null!==a?a:""})};var monthNames,_base;null==this.Fontana&&(this.Fontana={}),null==(_base=this.Fontana).utils&&(_base.utils={}),monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.Fontana.utils.prettyDate=function(t){var e,s,n,a;return e=new Date(t),a=(new Date).getTime(),n=(a-e.getTime())/1e3,s=Math.floor(n/86400),isNaN(e)?t:isNaN(s)||0>s||s>=1?365>=s?""+e.getDate()+" "+monthNames[e.getMonth()]:""+e.getDate()+" "+monthNames[e.getMonth()]+" "+e.getFullYear():!s&&10>n?"just now":!s&&60>n?""+Math.floor(n)+"s":!s&&3600>n?""+Math.floor(n/60)+"m":!s&&86400>n?""+Math.floor(n/3600)+"h":void 0};var messageTemplate,transitionEffects;null==this.Fontana&&(this.Fontana={}),messageTemplate='<div id="{id}" class="message media well col-md-6 col-md-offset-3"> <figure class="pull-left media-object"> <img src="{user.profile_image_url}" width="64" height="64" alt="" class="avatar img-thumbnail"> </figure> <div class="media-body"> <div class="media-heading"> <cite> <span class="name">{user.name}</span> <small class="text-muted"> <span class="screen_name">@{user.screen_name}</span> <time class="time pull-right" data-time="{created_at}">{created_at}</time> </small> </cite> </div> <div class="text lead"><q>{text}</q></div> </div> </div>',transitionEffects=["compress","fade-in","hinge","lightspeed","scroll-up","scroll-down","slide","tilt-scroll","vertigo","zoom-in"],Fontana.Visualizer=function(){function t(t,e){this.container=t,this.datasource=e,this.paused=!1,this.fetchMessagesTimer=-1,this.animationTimer=-1}return t.prototype.start=function(t){return this.fetchMessages(!0),this.container.empty(),this.config(t),this.scheduleUpdateAllTimes()},t.prototype.config=function(t){return transitionEffects.forEach(function(t){return function(e){return t.container.removeClass(e)}}(this)),this.container.addClass(t&&t.transition&&transitionEffects.indexOf(t.transition)>-1?t.transition:transitionEffects[0])},t.prototype.pause=function(){return this.paused?void 0:(clearTimeout(this.fetchMessagesTimer),clearTimeout(this.animationTimer),this.paused=!0)},t.prototype.resume=function(){return this.paused?(this.fetchMessages(),this.animate(),this.paused=!1):void 0},t.prototype.stop=function(){return this.pause(),this.container.empty()},t.prototype.fetchMessages=function(t){return null==t&&(t=!1),this.datasource.getMessages(function(e){return function(s){return e.renderMessages(s,t),e.scheduleFetchMessages()}}(this))},t.prototype.renderMessages=function(t,e){return null==e&&(e=!1),t.reverse().forEach(function(t){return function(e){var s;return $("#"+e.id).length?void 0:(e.text=e.entities?twttr.txt.autoLinkWithJSON(e.text,e.entities,{targetBlank:!0}):twttr.txt.autoLink(e.text,{targetBlank:!0}),s=$(nano(messageTemplate,e)),t.updateTime(s),t.container.prepend(s))}}(this)),e?this.scheduleAnimation():void 0},t.prototype.animate=function(){var t,e,s;return t=$(".message",this.container),t.removeClass("next next-one focus prev-one prev "),this.current=this.current&&this.current.next().length?this.current.next():$(".message:first",this.container),e=this.current.next(),e.length||(e=$(".message:first",this.container)),this.current.addClass("focus"),e.addClass("next-one"),e.nextAll(":not(.focus)").addClass("next"),s=this.current.prev(),s.length||(s=$(".message:last",this.container)),s.addClass("prev-one").removeClass("next"),s.prevAll(":not(.next-one):not(.next):not(.focus)").addClass("prev"),this.scheduleAnimation()},t.prototype.updateAllTimes=function(){return $(".message",this.container).each(function(t){return function(e,s){return t.updateTime(s)}}(this)),this.scheduleUpdateAllTimes()},t.prototype.updateTime=function(t){var e;return e=$(".time",t),e.text(Fontana.utils.prettyDate(e.data("time")))},t.prototype.scheduleAnimation=function(){var t;return t=-1===this.animationTimer?0:6e3,this.animationTimer=setTimeout(function(t){return function(){return t.animate()}}(this),t)},t.prototype.scheduleFetchMessages=function(){return this.fetchMessagesTimer=setTimeout(function(t){return function(){return t.fetchMessages()}}(this),3e4)},t.prototype.scheduleUpdateAllTimes=function(){return setTimeout(function(t){return function(){return t.updateAllTimes()}}(this),1e4)},t}(),this.Fontana.Visualizer.transitionEffects=transitionEffects;