var _base,__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};null==this.Fontana&&(this.Fontana={}),null==(_base=this.Fontana).datasources&&(_base.datasources={}),this.Fontana.datasources.Static=function(){function t(t){this.messages=null!=t?t:[]}return t.prototype.setMessages=function(t){return null==this.messages&&(this.messages=[]),this.mesages=t.concat(this.mesages)},t.prototype.getMessages=function(t){return t?setTimeout(function(e){return function(){return t(e.messages)}}(this),0):void 0},t}(),this.Fontana.datasources.HTML=function(){function t(t){this.container=t,this.messages=[]}return t.prototype.extractMessages=function(){var t;return t=[],$(".message",this.container).each(function(e,n){return t.push({id:n.id,created_at:(new Date).toString(),text:$(".text",n).text(),user:{name:$(".name",n).text(),screen_name:$(".screen_name",n).text().replace(/^@/,""),profile_image_url:$(".avatar",n).attr("src")}})}),t},t.prototype.getMessages=function(t){var e,n,s;return e=[function(){var t,e,s,a;for(s=this.messages,a=[],t=0,e=s.length;e>t;t++)n=s[t],a.push(n.id);return a}.call(this)],s=[],this.extractMessages().forEach(function(t){var n;return n=t.id,__indexOf.call(e,n)<0?s.push(t):void 0}),this.messages=s.concat(this.messages),t?setTimeout(function(e){return function(){return t(e.messages)}}(this),0):void 0},t}(),this.Fontana.datasources.TwitterSearch=function(){function t(t){this.q=t,this.params={since_id:1,q:this.q,result_type:"recent"},this.lastCall=0,this.messages=[]}var e;return e=5e3,t.prototype.getMessages=function(t){var n;return n=(new Date).getTime(),n-this.lastCall<e?t?setTimeout(function(e){return function(){return t(e.messages)}}(this),0):void 0:(this.lastCall=(new Date).getTime(),$.getJSON("/api/twitter/search/",this.params).success(function(e){return function(n){return n.statuses.length&&(e.messages=n.statuses.concat(e.messages),e.params.since_id=e.messages[0].id_str),t?t(e.messages.length?e.messages:[{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Your search term returned no Tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}}(this)).error(function(){return t?t([{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Error fetching tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}))},t}(),this.Fontana.datasources.TwitterSearchFA=function(){function t(t,e){this.q=t,this.res=e,this.params={since_id:1,q:this.q,result_type:"recent"},this.lastCall=0,this.messages=[]}var e;return e=5e3,t.prototype.getMessages=function(t){var n;return n=(new Date).getTime(),n-this.lastCall<e?t?setTimeout(function(e){return function(){return t(e.messages)}}(this),0):void 0:(this.lastCall=(new Date).getTime(),this.res.get({url:"https://api.twitter.com/1.1/search/tweets.json",data:this.params,dataType:"json"}).success(function(e){return function(n){return n.statuses.length&&(e.messages=n.statuses.concat(e.messages),e.params.since_id=e.messages[0].id_str),t?t(e.messages.length?e.messages:[{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Your search term returned no Tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}}(this)).error(function(){return t?t([{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Error fetching tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}))},t}();var nano;nano=function(t,e){return t.replace(/\{([\w\.]*)\}/g,function(t,n){var s,a,i,r;for(s=n.split("."),a=e[s.shift()],i=0,r=s.length;r>i;i++)n=s[i],a=a[n];return"undefined"!=typeof a&&null!==a?a:""})};var monthNames,vendors,_base;null==this.Fontana&&(this.Fontana={}),null==(_base=this.Fontana).utils&&(_base.utils={}),monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.Fontana.utils.prettyDate=function(t){var e,n,s,a;return e=new Date(t),a=(new Date).getTime(),s=(a-e.getTime())/1e3,n=Math.floor(s/86400),isNaN(e)?t:isNaN(n)||0>n||n>=1?365>=n?""+e.getDate()+" "+monthNames[e.getMonth()]:""+e.getDate()+" "+monthNames[e.getMonth()]+" "+e.getFullYear():!n&&10>s?"just now":!n&&60>s?""+Math.floor(s)+"s":!n&&3600>s?""+Math.floor(s/60)+"m":!n&&86400>s?""+Math.floor(s/3600)+"h":void 0},vendors=["webkit","moz","ms"],this.Fontana.utils.requestFullScreen=function(t){var e;return e=t.requestFullscreen||t.requestFullScreen,vendors.some(function(n){return null==e&&(e=t[n+"RequestFullScreen"]),!!e}),e?e.call(t,Element.ALLOW_KEYBOARD_INPUT):void 0},this.Fontana.utils.cancelFullScreen=function(){var t;return t=document.exitFullscreen||document.cancelFullScreen,vendors.some(function(e){return null==t&&(t=document[e+"CancelFullScreen"]),!!t}),t?t.call(document):void 0},this.Fontana.utils.isFullScreen=function(){var t;return t=document.fullScreen||document.isFullScreen,vendors.some(function(e){return null==t&&(t=document[e+"FullScreen"]||document[e+"IsFullScreen"]),!!t}),!!t};var messageTemplate,transitionEffects;null==this.Fontana&&(this.Fontana={}),messageTemplate='<div id="{id}" class="message media well col-md-6 col-md-offset-3"> <figure class="pull-left media-object"> <img src="{user.profile_image_url}" width="64" height="64" alt="" class="avatar img-thumbnail"> </figure> <div class="media-body"> <div class="media-heading"> <cite> <span class="name">{user.name}</span> <small class="text-muted"> <span class="screen_name">@{user.screen_name}</span> <time class="time pull-right" data-time="{created_at}">{created_at}</time> </small> </cite> </div> <div class="text lead"><q>{text}</q></div> </div> </div>',transitionEffects=["compress","fade-in","hinge","lightspeed","scroll-up","scroll-down","slide","tilt-scroll","vertigo","zoom-in"],Fontana.Visualizer=function(){function t(t,e){this.container=t,this.datasource=e,this.paused=!1,this.fetchMessagesTimer=-1,this.animationTimer=-1}return t.prototype.start=function(t){return this.fetchMessages(!0),this.container.empty(),this.config(t),this.scheduleUpdateAllTimes()},t.prototype.config=function(t){return transitionEffects.forEach(function(t){return function(e){return t.container.removeClass(e)}}(this)),this.container.addClass(t&&t.transition&&transitionEffects.indexOf(t.transition)>-1?t.transition:transitionEffects[0])},t.prototype.pause=function(){return this.paused?void 0:(clearTimeout(this.fetchMessagesTimer),clearTimeout(this.animationTimer),this.paused=!0)},t.prototype.resume=function(){return this.paused?(this.fetchMessages(),this.animate(),this.paused=!1):void 0},t.prototype.stop=function(){return this.pause(),this.container.empty()},t.prototype.fetchMessages=function(t){return null==t&&(t=!1),this.datasource.getMessages(function(e){return function(n){return e.renderMessages(n,t),e.scheduleFetchMessages()}}(this))},t.prototype.renderMessages=function(t,e){return null==e&&(e=!1),t.reverse().forEach(function(t){return function(e){var n;return $("#"+e.id).length?void 0:(e.text=e.entities?twttr.txt.autoLinkWithJSON(e.text,e.entities,{targetBlank:!0}):twttr.txt.autoLink(e.text,{targetBlank:!0}),n=$(nano(messageTemplate,e)),t.updateTime(n),t.container.prepend(n))}}(this)),e?this.scheduleAnimation():void 0},t.prototype.animate=function(){var t,e,n;return t=$(".message",this.container),t.removeClass("next next-one focus prev-one prev "),this.current=this.current&&this.current.next().length?this.current.next():$(".message:first",this.container),e=this.current.next(),e.length||(e=$(".message:first",this.container)),this.current.addClass("focus"),e.addClass("next-one"),e.nextAll(":not(.focus)").addClass("next"),n=this.current.prev(),n.length||(n=$(".message:last",this.container)),n.addClass("prev-one").removeClass("next"),n.prevAll(":not(.next-one):not(.next):not(.focus)").addClass("prev"),this.scheduleAnimation()},t.prototype.updateAllTimes=function(){return $(".message",this.container).each(function(t){return function(e,n){return t.updateTime(n)}}(this)),this.scheduleUpdateAllTimes()},t.prototype.updateTime=function(t){var e;return e=$(".time",t),e.text(Fontana.utils.prettyDate(e.data("time")))},t.prototype.scheduleAnimation=function(){var t;return t=-1===this.animationTimer?0:6e3,this.animationTimer=setTimeout(function(t){return function(){return t.animate()}}(this),t)},t.prototype.scheduleFetchMessages=function(){return this.fetchMessagesTimer=setTimeout(function(t){return function(){return t.fetchMessages()}}(this),3e4)},t.prototype.scheduleUpdateAllTimes=function(){return setTimeout(function(t){return function(){return t.updateAllTimes()}}(this),1e4)},t}(),this.Fontana.Visualizer.transitionEffects=transitionEffects;